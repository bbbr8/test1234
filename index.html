<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="color-scheme" content="light dark" />
  <title>briefly</title>
  <style>
    :root{
      --bg:#f8fafc; --panel:#ffffff; --ink:#111827; --muted:#6b7280; --brand:#2563eb;
      --border:#e5e7eb; --radius:10px; --gap:12px; --pad:20px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--ink)}
    .wrap{max-width:980px;margin:40px auto;padding:0 16px}
    .appbar{display:flex;align-items:center;gap:10px;margin-bottom:16px}
    .appbar img{height:32px;width:auto}
    .appbar .brand{font-weight:800;font-size:18px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:var(--pad);box-shadow:0 2px 10px rgba(0,0,0,.04)}
    h1{margin:0 0 12px}
    label{display:block;margin:14px 0 6px;font-weight:600}
    input,select{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:8px}
    .row{display:flex;gap:var(--gap)} .row>div{flex:1}
    .actions{display:flex;gap:var(--gap);margin-top:16px}
    button{cursor:pointer;border:none;border-radius:8px;padding:10px 14px;background:var(--brand);color:#fff;font-weight:700}
    button:hover{filter:brightness(.95)} .btn-ghost{background:#6b7280} .btn-ghost:hover{background:#4b5563}
    .hidden{display:none}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid var(--border);padding:8px;text-align:left}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .summary{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;margin:10px 0 0}
    .summary div{background:#f3f4f6;border:1px solid var(--border);border-radius:8px;padding:10px}
    @media (prefers-color-scheme: dark){
      :root{--bg:#0b1220;--panel:#0f172a;--ink:#e5e7eb;--muted:#94a3b8;--border:#1f2937}
      .summary div{background:#111827}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="appbar">
      <!-- Optional logo: add logo-briefly.png to your repo root -->
      <img src="logo-briefly.png" alt="briefly logo" onerror="this.style.display='none'"/>
      <span class="brand">briefly</span>
    </header>

    <main>
      <!-- LOGIN -->
      <section id="login" class="card" aria-labelledby="h-login">
        <h1 id="h-login">Login</h1>
        <div class="row">
          <div>
            <label for="loginEmail">Email</label>
            <input id="loginEmail" type="email" autocomplete="email" autocapitalize="none" inputmode="email" />
          </div>
          <div>
            <label for="loginPass">Password</label>
            <input id="loginPass" type="password" autocomplete="current-password" />
          </div>
        </div>
        <div class="actions">
          <button id="loginNext" type="button">Next</button>
        </div>
      </section>

      <!-- PROFILE -->
      <section id="profile" class="card hidden" aria-labelledby="h-profile">
        <h1 id="h-profile">Profile Setup</h1>
        <form id="profileForm">
          <div class="row">
            <div>
              <label for="firstName">First Name</label>
              <input id="firstName" name="firstName" required />
            </div>
            <div>
              <label for="lastName">Last Name</label>
              <input id="lastName" name="lastName" required />
            </div>
          </div>
          <label for="caseName">Case Name</label>
          <input id="caseName" name="caseName" placeholder="e.g., Jones v. Suited Homes" />

          <label for="role">Role</label>
          <select id="role" name="role">
            <option value="">— Select —</option>
            <option value="Plaintiff">Plaintiff</option>
            <option value="Defendant">Defendant</option>
          </select>

          <div class="actions">
            <button type="button" class="btn-ghost" id="backToLogin">Back</button>
            <button type="submit">Save Profile</button>
          </div>
          <p id="profileMsg" role="status" style="color:var(--muted);margin-top:8px;"></p>
        </form>
      </section>

      <!-- ACCOUNT -->
      <section id="account" class="card hidden" aria-labelledby="h-account">
        <h1 id="h-account">Account Details</h1>
        <form id="accountForm">
          <div class="row">
            <div>
              <label for="caseNumber">Case Number</label>
              <input id="caseNumber" />
            </div>
            <div>
              <label for="accountRole">Role</label>
              <select id="accountRole">
                <option value="Plaintiff">Plaintiff</option>
                <option value="Defendant">Defendant</option>
              </select>
            </div>
          </div>

          <label for="documents">Documents</label>
          <input id="documents" type="file" multiple />

          <table id="docsTable">
            <thead>
              <tr>
                <th>Name</th><th>Size (KB)</th><th>Type</th><th>Category</th><th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <div class="actions">
            <button type="button" class="btn-ghost" id="backToProfile">Back</button>
            <button type="button" id="saveAccountBtn">Save &amp; Continue</button>
          </div>
        </form>
      </section>

      <!-- DASHBOARD -->
      <section id="dashboard" class="card hidden" aria-labelledby="h-dashboard">
        <div class="topbar">
          <h1 id="h-dashboard">Briefly Dashboard</h1>
          <button class="btn-ghost" id="signOutBtn">Sign Out</button>
        </div>

        <div class="summary">
          <div><strong>Name</strong><div id="sumName">—</div></div>
          <div><strong>Case</strong><div id="sumCase">—</div></div>
          <div><strong>Role</strong><div id="sumRole">—</div></div>
        </div>

        <h2 style="margin-top:16px">Case Info</h2>
        <p id="caseInfo">—</p>

        <h2>Documents</h2>
        <table id="docsList">
          <thead>
            <tr>
              <th>Name</th><th>Size (KB)</th><th>Type</th><th>Category</th><th>Added</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <div class="actions">
          <button type="button" id="manageDocsBtn">Manage Documents</button>
        </div>

        <p style="color:var(--muted);margin-top:12px">Next: add REPC/Budget cards with toggles.</p>
      </section>
    </main>
  </div>

  <script>
    // ---------- helpers ----------
    const K_PROFILE = "briefly:v1:profile";
    const K_ACCOUNT = "briefly:v1:account";
    const K_DOCS    = "briefly:v1:docs";
    const screens = ["login","profile","account","dashboard"];

    const getJSON = (k, def=null) => { try { return JSON.parse(localStorage.getItem(k) ?? "null") ?? def; } catch { return def; } };
    const setJSON = (k, v) => localStorage.setItem(k, JSON.stringify(v));
    const del = (k) => localStorage.removeItem(k);

    function firstFocusable(el){
      return el.querySelector('input, select, button, textarea, [tabindex]:not([tabindex="-1"])');
    }

    function showScreen(name){
      screens.forEach(id=>{
        const el = document.getElementById(id);
        if (!el) return;
        el.classList.toggle("hidden", id!==name);
      });
      document.title = `briefly — ${name}`;
      const focusTarget = firstFocusable(document.getElementById(name));
      focusTarget && focusTarget.focus({preventScroll:true});
      location.hash = `#${name}`;
    }

    function renderDashboard(){
      const p = getJSON(K_PROFILE, {});
      const a = getJSON(K_ACCOUNT, {});
      document.getElementById("sumName").textContent = [p.firstName, p.lastName].filter(Boolean).join(" ") || "—";
      document.getElementById("sumCase").textContent = p.caseName || "—";
      document.getElementById("sumRole").textContent = p.role || "—";
      document.getElementById("caseInfo").textContent =
        a.caseNumber ? `Case #${a.caseNumber} — ${a.role || "—"}` : "—";

      // docs table on dashboard
      const docs = getJSON(K_DOCS, []);
      const tbody = document.querySelector("#docsList tbody");
      tbody.innerHTML = "";
      docs.forEach(d=>{
        const tr = document.createElement("tr");
        const added = new Date(d.addedAt||Date.now()).toLocaleString();
        tr.innerHTML = `
          <td>${d.name}</td>
          <td>${Math.max(1, Math.round((d.size||0)/1024))}</td>
          <td>${d.type || "—"}</td>
          <td>${d.category || "Case Document"}</td>
          <td>${added}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ---------- login/profile wiring ----------
    document.getElementById("loginNext").addEventListener("click", ()=> showScreen("profile"));
    document.getElementById("backToLogin").addEventListener("click", ()=> showScreen("login"));

    document.getElementById("profileForm").addEventListener("submit",(e)=>{
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target).entries());
      setJSON(K_PROFILE, data);
      document.getElementById("profileMsg").textContent = "Profile saved.";
      // prefill account role
      const accRole = document.getElementById("accountRole");
      if (accRole && data.role) accRole.value = data.role;
      showScreen("account");
    });

    // ---------- account + docs ----------
    let docs = getJSON(K_DOCS, []);
    const docsInput = document.getElementById("documents");
    const docsTableBody = document.querySelector("#docsTable tbody");

    function renderDocsTable(){
      docsTableBody.innerHTML = "";
      docs.forEach((d,i)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${d.name}</td>
          <td>${Math.max(1,Math.round(d.size/1024))}</td>
          <td>${d.type || "—"}</td>
          <td>
            <select data-idx="${i}">
              <option ${d.category==="Case Document"?"selected":""}>Case Document</option>
              <option ${d.category==="Motion"?"selected":""}>Motion</option>
              <option ${d.category==="Subpoena"?"selected":""}>Subpoena</option>
              <option ${d.category==="Other"?"selected":""}>Other</option>
            </select>
          </td>
          <td><button type="button" data-rm="${i}">Remove</button></td>
        `;
        docsTableBody.appendChild(tr);
      });
    }

    docsInput.addEventListener("change",(e)=>{
      const files = Array.from(e.target.files || []);
      files.forEach(f=>{
        docs.push({
          id: (crypto?.randomUUID?.() || String(Date.now()+Math.random())),
          name: f.name, size: f.size, type: f.type,
          category: "Case Document", addedAt: Date.now()
        });
      });
      setJSON(K_DOCS, docs);
      renderDocsTable();
      docsInput.value = "";
    });

    document.getElementById("docsTable").addEventListener("change",(e)=>{
      if (e.target.tagName!=="SELECT") return;
      const i = Number(e.target.dataset.idx);
      if (!Number.isNaN(i) && docs[i]) {
        docs[i].category = e.target.value;
        setJSON(K_DOCS, docs);
      }
    });

    document.getElementById("docsTable").addEventListener("click",(e)=>{
      if (!e.target.dataset.rm) return;
      const i = Number(e.target.dataset.rm);
      docs.splice(i,1);
      setJSON(K_DOCS, docs);
      renderDocsTable();
    });

    document.getElementById("backToProfile").addEventListener("click", ()=> showScreen("profile"));

    document.getElementById("saveAccountBtn").addEventListener("click", ()=>{
      const caseNumber = document.getElementById("caseNumber").value.trim();
      const role = document.getElementById("accountRole").value;
      setJSON(K_ACCOUNT, { caseNumber, role });
      setJSON(K_DOCS, docs); // ensure persisted
      showScreen("dashboard");
      renderDashboard();
    });

    // ---------- dashboard wiring ----------
    document.getElementById("signOutBtn").addEventListener("click", ()=>{
      [K_PROFILE, K_ACCOUNT, K_DOCS].forEach(del);
      docs = [];
      showScreen("login");
    });
    document.getElementById("manageDocsBtn").addEventListener("click", ()=> showScreen("account"));

    // ---------- initial route ----------
    (function init(){
      // set account role default from profile if exists
      const p = getJSON(K_PROFILE);
      if (p?.role) { const r = document.getElementById("accountRole"); if (r) r.value = p.role; }
      docs = getJSON(K_DOCS, []);
      renderDocsTable();

      const hasProfile = !!getJSON(K_PROFILE);
      const hasAccount = !!getJSON(K_ACCOUNT);
      if (!hasProfile) showScreen("login");
      else if (!hasAccount) showScreen("account");
      else { showScreen("dashboard"); renderDashboard(); }

      // hash navigation (optional)
      window.addEventListener("hashchange", ()=>{
        const key = location.hash.replace("#","");
        if (screens.includes(key)) showScreen(key);
      });
    })();
  </script>
</body>
</html>
